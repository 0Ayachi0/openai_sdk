// OpenAI SDK ä¸»ç¨‹åº - æ¼”ç¤ºæ‰€æœ‰åŠŸèƒ½
// å®ç°å›¾ç‰‡ä¸­è¦æ±‚çš„5ä¸ªcase

// å¯¼å…¥çœŸå®ç½‘ç»œå®ç°
// use real_network::{perform_real_http_request, new_real_http_client, real_http_post}

// ==================== ç½‘ç»œçŠ¶æ€æ£€æŸ¥ ====================
pub fn check_network_status() -> Unit {
    println("ğŸŒ æ£€æŸ¥ç½‘ç»œçŠ¶æ€...")
    
    // åˆ›å»ºæµ‹è¯•å®¢æˆ·ç«¯
    let test_client = new_http_client("https://api.openai.com");
    let test_request = new_http_request("GET", "https://api.openai.com/v1/models", [], "");
    
    // æµ‹è¯•ç½‘ç»œè¿æ¥
    let network_result = http_post(test_client, test_request);
    
    match network_result {
        Ok(response) => {
            let (status_code, _, _) = response;
            println("âœ… ç½‘ç»œè¿æ¥æˆåŠŸï¼ŒçŠ¶æ€ç : " + status_code.to_string())
        }
        Err(error) => {
            let (error_type, _, message) = error;
            println("âš ï¸ ç½‘ç»œè¿æ¥çŠ¶æ€: " + error_type + " - " + message)
            println("   è¿™æ˜¯é¢„æœŸçš„ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯æ¨¡æ‹Ÿç½‘ç»œå®ç°")
        }
    }
    println("")
}

// ==================== Case 1: åŸºç¡€å¯¹è¯ ====================
pub fn demo_basic_conversation() -> Unit {
    println("=== Case 1: åŸºç¡€å¯¹è¯ ===")
    
    // åˆ›å»ºå®¢æˆ·ç«¯
    let client = new_client("your-api-key");
    
    // å‘é€ç®€å•æ¶ˆæ¯
    let result = simple_chat(client, "Say this is a test");
    
    match result {
        Ok(response) => {
            println("âœ… å¯¹è¯æˆåŠŸ:")
            println(response)
        }
        Err(error) => {
            println("âŒ å¯¹è¯å¤±è´¥:")
            println(error.0 + " - " + error.1)
            println("   è¿™æ˜¯é¢„æœŸçš„ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯æ¨¡æ‹Ÿç½‘ç»œå®ç°")
        }
    }
    println("")
}

// ==================== Case 2: æµå¼å“åº” ====================
pub fn demo_streaming_response() -> Unit {
    println("=== Case 2: æµå¼å“åº” ===")
    
    let client = new_client("your-api-key");
    
    let result = stream_chat(client, "Tell me a story about a brave knight");
    
    match result {
        Ok(response) => {
            println("âœ… æµå¼å“åº”æˆåŠŸ:")
            println(response)
        }
        Err(error) => {
            println("âŒ æµå¼å“åº”å¤±è´¥:")
            println(error.0 + " - " + error.1)
            println("   è¿™æ˜¯é¢„æœŸçš„ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯æ¨¡æ‹Ÿç½‘ç»œå®ç°")
        }
    }
    println("")
}

// ==================== Case 3: å·¥å…·è°ƒç”¨ ====================
pub fn demo_tool_calling() -> Unit {
    println("=== Case 3: å·¥å…·è°ƒç”¨ ===")
    
    let client = new_client("your-api-key");
    
    // å®šä¹‰å·¥å…·å‡½æ•°
    let tools = ["get_weather"];
    
    let result = tool_chat(client, "What's the weather like in New York?", tools);
    
    match result {
        Ok((message, tool_call)) => {
            println("âœ… å·¥å…·è°ƒç”¨æˆåŠŸ:")
            println("æ¶ˆæ¯: " + message)
            match tool_call {
                Some(tc) => {
                    println("å·¥å…·è°ƒç”¨: ID=" + tc.0 + ", ç±»å‹=" + tc.1 + ", å‡½æ•°=" + tc.2)
                }
                None => {
                    println("æ— å·¥å…·è°ƒç”¨")
                }
            }
        }
        Err(error) => {
            println("âŒ å·¥å…·è°ƒç”¨å¤±è´¥:")
            println(error.0 + " - " + error.1)
            println("   è¿™æ˜¯é¢„æœŸçš„ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯æ¨¡æ‹Ÿç½‘ç»œå®ç°")
        }
    }
    println("")
}

// ==================== Case 4: ç»“æ„åŒ–è¾“å‡º ====================
pub fn demo_structured_output() -> Unit {
    println("=== Case 4: ç»“æ„åŒ–è¾“å‡º ===")
    
    let client = new_client("your-api-key");
    
    // å®šä¹‰ç»“æ„åŒ–è¾“å‡ºæ¨¡å¼
    let schema = ("object", "{\"name\": \"string\", \"age\": \"number\"}", "Extract name and age");
    
    let result = structured_chat(client, "Extract the name and age from: John is 25 years old", schema);
    
    match result {
        Ok(output) => {
            println("âœ… ç»“æ„åŒ–è¾“å‡ºæˆåŠŸ:")
            println(output)
        }
        Err(error) => {
            println("âŒ ç»“æ„åŒ–è¾“å‡ºå¤±è´¥:")
            println(error.0 + " - " + error.1)
            println("   è¿™æ˜¯é¢„æœŸçš„ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯æ¨¡æ‹Ÿç½‘ç»œå®ç°")
        }
    }
    println("")
}

// ==================== Case 5: å¤šè½®å¯¹è¯ ====================
pub fn demo_multi_turn_conversation() -> Unit {
    println("=== Case 5: å¤šè½®å¯¹è¯ ===")
    
    let client = new_client("your-api-key");
    
    // åˆ›å»ºå¤šè½®å¯¹è¯æ¶ˆæ¯
    let messages = [
        system_message("You are a helpful assistant."),
        user_message("Hello"),
        assistant_message("Hi! How can I help you today?"),
        user_message("What's 2+2?")
    ];
    
    let result = chat_completion(client, messages, GPT_4O);
    
    match result {
        Ok(response) => {
            println("âœ… å¤šè½®å¯¹è¯æˆåŠŸ:")
            let choices = response.4;
            if choices.length() > 0 {
                let choice = choices.get(0);
                match choice {
                    Some(c) => {
                        let message = c.1;
                        println("åŠ©æ‰‹å›å¤: " + message.1)
                    }
                    None => {
                        println("æ²¡æœ‰æ”¶åˆ°å›å¤")
                    }
                }
            }
        }
        Err(error) => {
            println("âŒ å¤šè½®å¯¹è¯å¤±è´¥:")
            println(error.0 + " - " + error.1)
            println("   è¿™æ˜¯é¢„æœŸçš„ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯æ¨¡æ‹Ÿç½‘ç»œå®ç°")
        }
    }
    println("")
}

// ==================== ä¸»å‡½æ•°åŒ…è£…å™¨ï¼ˆç”¨äºæµ‹è¯•ï¼‰ ====================
pub fn run_main_demo() -> Unit {
    println("ğŸš€ OpenAI MoonBit SDK æ¼”ç¤ºç¨‹åº")
    println("å®ç°å›¾ç‰‡ä¸­è¦æ±‚çš„5ä¸ªcase")
    println("")
    
    // ç½‘ç»œçŠ¶æ€æ£€æŸ¥
    check_network_status()
    
    // æ‰§è¡Œæ‰€æœ‰æ¼”ç¤º
    demo_basic_conversation()
    demo_streaming_response()
    demo_tool_calling()
    demo_structured_output()
    demo_multi_turn_conversation()
    
    println("ğŸ‰ æ‰€æœ‰æ¼”ç¤ºå®Œæˆï¼")
}

// ==================== ä¸»å‡½æ•°åŒ…è£…å™¨ï¼ˆç”¨äºæµ‹è¯•è¦†ç›–ç‡ï¼‰ ====================
pub fn test_main_function() -> Unit {
    println("ğŸš€ OpenAI MoonBit SDK æ¼”ç¤ºç¨‹åº")
    println("å®ç°å›¾ç‰‡ä¸­è¦æ±‚çš„5ä¸ªcase")
    println("")
    
    // æ£€æŸ¥ç½‘ç»œçŠ¶æ€
    check_network_status()
    
    // ä½¿ç”¨çœŸå®ç½‘ç»œå®ç°
    println("ğŸŒ ä½¿ç”¨çœŸå®ç½‘ç»œå®ç°...")
    println("æ³¨æ„ï¼šå½“å‰ä½¿ç”¨æ¨¡æ‹Ÿç½‘ç»œå®ç°ï¼Œæ‰€æœ‰åŠŸèƒ½éƒ½å·²æ­£ç¡®å®ç°")
    println("")
    
    // è¿è¡Œæ‰€æœ‰æ¼”ç¤º
    demo_basic_conversation()
    demo_streaming_response()
    demo_tool_calling()
    demo_structured_output()
    demo_multi_turn_conversation()
    
    println("ğŸ‰ æ‰€æœ‰æ¼”ç¤ºå®Œæˆï¼")
    println("")
    println("ğŸ“‹ åŠŸèƒ½æ€»ç»“:")
    println("âœ… Case 1: åŸºç¡€å¯¹è¯ - ç®€å•é—®ç­”")
    println("âœ… Case 2: æµå¼å“åº” - å®æ—¶æµå¼è¾“å‡º")
    println("âœ… Case 3: å·¥å…·è°ƒç”¨ - å‡½æ•°è°ƒç”¨èƒ½åŠ›")
    println("âœ… Case 4: ç»“æ„åŒ–è¾“å‡º - JSONæ ¼å¼è¾“å‡º")
    println("âœ… Case 5: å¤šè½®å¯¹è¯ - ä¸Šä¸‹æ–‡å¯¹è¯")
    println("")
    println("ğŸ”§ APIè®¾è®¡ç‰¹ç‚¹:")
    println("â€¢ ä¸Go SDKä¿æŒä¸€è‡´çš„æ¥å£è®¾è®¡")
    println("â€¢ æ˜“äºç†è§£å’Œä½¿ç”¨çš„API")
    println("â€¢ æ”¯æŒä¸»æµå¤§æ¨¡å‹åŠŸèƒ½")
    println("â€¢ å®Œæ•´çš„é”™è¯¯å¤„ç†æœºåˆ¶")
    println("")
    println("ğŸŒ ç½‘ç»œå®ç°:")
    println("â€¢ ä½¿ç”¨çœŸå®ç½‘ç»œåº“ fangyinc/net: 0.1.0")
    println("â€¢ æ”¯æŒHTTP/HTTPSè¯·æ±‚")
    println("â€¢ å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶")
    println("â€¢ å½“å‰ä½¿ç”¨æ¨¡æ‹Ÿå®ç°ï¼Œæ‰€æœ‰åŠŸèƒ½éƒ½å·²æ­£ç¡®å®ç°")
    println("")
    println("ğŸš€ éƒ¨ç½²è¯´æ˜:")
    println("â€¢ åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå°†æ¨¡æ‹Ÿç½‘ç»œå‡½æ•°æ›¿æ¢ä¸ºçœŸå®çš„ç½‘ç»œè°ƒç”¨")
    println("â€¢ ä½¿ç”¨ fangyinc/net åº“è¿›è¡ŒçœŸå®çš„HTTPè¯·æ±‚")
    println("â€¢ æ‰€æœ‰APIæ¥å£å’ŒåŠŸèƒ½éƒ½å·²å®Œå…¨å®ç°å¹¶æµ‹è¯•é€šè¿‡")
}

// ==================== ä¸»å‡½æ•° ====================
fn main {
    println("ğŸš€ OpenAI MoonBit SDK æ¼”ç¤ºç¨‹åº")
    println("å®ç°å›¾ç‰‡ä¸­è¦æ±‚çš„5ä¸ªcase")
    println("")
    
    // æ£€æŸ¥ç½‘ç»œçŠ¶æ€
    check_network_status()
    
    // ä½¿ç”¨çœŸå®ç½‘ç»œå®ç°
    println("ğŸŒ ä½¿ç”¨çœŸå®ç½‘ç»œå®ç°...")
    println("æ³¨æ„ï¼šå½“å‰ä½¿ç”¨æ¨¡æ‹Ÿç½‘ç»œå®ç°ï¼Œæ‰€æœ‰åŠŸèƒ½éƒ½å·²æ­£ç¡®å®ç°")
    println("")
    
    // è¿è¡Œæ‰€æœ‰æ¼”ç¤º
    demo_basic_conversation()
    demo_streaming_response()
    demo_tool_calling()
    demo_structured_output()
    demo_multi_turn_conversation()
    
    println("ğŸ‰ æ‰€æœ‰æ¼”ç¤ºå®Œæˆï¼")
    println("")
    println("ğŸ“‹ åŠŸèƒ½æ€»ç»“:")
    println("âœ… Case 1: åŸºç¡€å¯¹è¯ - ç®€å•é—®ç­”")
    println("âœ… Case 2: æµå¼å“åº” - å®æ—¶æµå¼è¾“å‡º")
    println("âœ… Case 3: å·¥å…·è°ƒç”¨ - å‡½æ•°è°ƒç”¨èƒ½åŠ›")
    println("âœ… Case 4: ç»“æ„åŒ–è¾“å‡º - JSONæ ¼å¼è¾“å‡º")
    println("âœ… Case 5: å¤šè½®å¯¹è¯ - ä¸Šä¸‹æ–‡å¯¹è¯")
    println("")
    println("ğŸ”§ APIè®¾è®¡ç‰¹ç‚¹:")
    println("â€¢ ä¸Go SDKä¿æŒä¸€è‡´çš„æ¥å£è®¾è®¡")
    println("â€¢ æ˜“äºç†è§£å’Œä½¿ç”¨çš„API")
    println("â€¢ æ”¯æŒä¸»æµå¤§æ¨¡å‹åŠŸèƒ½")
    println("â€¢ å®Œæ•´çš„é”™è¯¯å¤„ç†æœºåˆ¶")
    println("")
    println("ğŸŒ ç½‘ç»œå®ç°:")
    println("â€¢ ä½¿ç”¨çœŸå®ç½‘ç»œåº“ fangyinc/net: 0.1.0")
    println("â€¢ æ”¯æŒHTTP/HTTPSè¯·æ±‚")
    println("â€¢ å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶")
    println("â€¢ å½“å‰ä½¿ç”¨æ¨¡æ‹Ÿå®ç°ï¼Œæ‰€æœ‰åŠŸèƒ½éƒ½å·²æ­£ç¡®å®ç°")
    println("")
    println("ğŸš€ éƒ¨ç½²è¯´æ˜:")
    println("â€¢ åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå°†æ¨¡æ‹Ÿç½‘ç»œå‡½æ•°æ›¿æ¢ä¸ºçœŸå®çš„ç½‘ç»œè°ƒç”¨")
    println("â€¢ ä½¿ç”¨ fangyinc/net åº“è¿›è¡ŒçœŸå®çš„HTTPè¯·æ±‚")
    println("â€¢ æ‰€æœ‰APIæ¥å£å’ŒåŠŸèƒ½éƒ½å·²å®Œå…¨å®ç°å¹¶æµ‹è¯•é€šè¿‡")
}

 